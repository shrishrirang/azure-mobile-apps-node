<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: src/auth/index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: src/auth/index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// ----------------------------------------------------------------------------
// Copyright (c) Microsoft Corporation. All rights reserved.
// ----------------------------------------------------------------------------
/**
@module azure-mobile-apps/auth
@description Helper functions for working with JWT tokens
*/
var user = require('./user'),
    jwt = require('jsonwebtoken'),
    crypto = require('crypto'),
    promises = require('../utilities/promises');

/**
Create an instance of a helper based on the supplied configuration.
@param {authConfiguration} configuration The authentication configuration
@returns An object with members described below.
*/
module.exports = function (configuration) {
    var key = hashSecret(configuration.secret);

    return {
        /**
        Validate a JWT token
        @param {string|Buffer} token The JWT token to validate
        @returns A promise that yields a {@link module:azure-mobile-apps/auth/user user} object on success.
        */
        validate: function (token) {
            return promises.create(function (resolve, reject) {
                var options = {
                    audience: configuration.audience || 'urn:microsoft:windows-azure:zumo',
                    issuer: configuration.issuer || 'urn:microsoft:windows-azure:zumo'
                };

                jwt.verify(token, key, options, function (err, claims) {
                    if(err)
                        reject(err);
                    else
                        resolve(user(configuration, token, claims));
                });
            });
        },
        /**
        Create a token from the specified payload
        @param {object} payload The payload to sign
        @returns {string} The signed token.
        */
        sign: function (payload) {
            var options = {
                audience: configuration.audience || 'urn:microsoft:windows-azure:zumo',
                issuer: configuration.issuer || 'urn:microsoft:windows-azure:zumo',
                expiresInMinutes: configuration.expires || 1440
            };
            return jwt.sign(payload, key, options);
        }
    };
};

function hashSecret(secret) {
    var hasher = crypto.createHash('sha256');
    hasher.update(secret, 'utf8');
    return hasher.digest();
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-azure-mobile-apps.html">/</a></li><li><a href="module-azure-mobile-apps_auth.html">auth</a></li><li><a href="module-azure-mobile-apps_auth_user.html">auth/user</a></li><li><a href="module-azure-mobile-apps_configuration.html">configuration</a></li><li><a href="module-azure-mobile-apps_cors.html">cors</a></li><li><a href="module-azure-mobile-apps_data.html">data</a></li><li><a href="module-azure-mobile-apps_express.html">express</a></li><li><a href="module-azure-mobile-apps_express_tables.html">express/tables</a></li><li><a href="module-azure-mobile-apps_express_tables_table.html">express/tables/table</a></li><li><a href="module-azure-mobile-apps_logger.html">logger</a></li><li><a href="module-azure-mobile-apps_query.html">query</a></li><li><a href="module-queryjs_Query.html">queryjs/Query</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.2</a> on Wed Sep 02 2015 14:03:51 GMT-0700 (Pacific Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
